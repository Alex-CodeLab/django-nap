<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Publishers &mdash; django-nap 0.13.6 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.13.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-nap 0.13.6 documentation" href="index.html" />
    <link rel="next" title="Authorisation" href="auth.html" />
    <link rel="prev" title="Fields" href="fields.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="auth.html" title="Authorisation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fields.html" title="Fields"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">django-nap 0.13.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="publishers">
<h1>Publishers<a class="headerlink" href="#publishers" title="Permalink to this headline">¶</a></h1>
<p>The publisher is a general purpose class for dispatching requests.  It&#8217;s similar
to the generic Class-Based Views in Django, but handles many views in a single
class.</p>
<p>This pattern works well for APIs, where typically a group of views require the
same functions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">r&#39;^object/(?P&lt;object_id&gt;[-\w]+)/(?P&lt;action&gt;\w+)/(?P&lt;argument&gt;.+?)/?$&#39;</span>
<span class="s">r&#39;^object/(?P&lt;object_id&gt;[-\w]+)/(?P&lt;action&gt;\w+)/?$&#39;</span>
<span class="s">r&#39;^object/(?P&lt;object_id&gt;[-\w]+)/?$&#39;</span>
<span class="s">r&#39;^(?P&lt;action&gt;\w+)/(?P&lt;argument&gt;.+?)/$&#39;</span>
<span class="s">r&#39;^(?P&lt;action&gt;\w+)/?$&#39;</span>
<span class="s">r&#39;^$&#39;</span>
</pre></div>
</div>
<p>Clearly this list does not permit &#8216;object&#8217; to be an action.</p>
<p>The publisher recognises a small, fixed set of URL patterns, and dispatches them
to methods on the class according to a simple pattern: target, method, action.
The target is either &#8220;list&#8221; or &#8220;object&#8221;, depending on if an object_id was
supplied.  The method is the HTTP method, lower cased (i.e. get, put, post,
delete, etc.).  And finally, the action, which defaults to &#8216;default&#8217;.</p>
<p>So, for example, a GET request to /foo would call the <tt class="docutils literal"><span class="pre">list_get_foo</span></tt> handler.
Whereas a POST to /object/123/nudge/ would call <tt class="docutils literal"><span class="pre">object_post_nudge</span></tt>, passing
&#8220;123&#8221; as the object_id.</p>
<p>All handlers should follow the same definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">object_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
</div>
<p>Both action and object_id are passed as kwargs, so where they&#8217;re not needed they
can be omitted.</p>
<p>Like a view, every handler is expected to return a proper HttpResponse object.</p>
<div class="section" id="publishing">
<h2>Publishing<a class="headerlink" href="#publishing" title="Permalink to this headline">¶</a></h2>
<p>In order to add a <tt class="docutils literal"><span class="pre">Publisher</span></tt> to your URL patterns, you need to include all of
its patterns.  Fortunately, it provides a handy method to make this simple:</p>
<blockquote>
<div>url(r&#8217;^myresource/&#8217;, include(MyPublisher.patterns())),</div></blockquote>
</div>
<div class="section" id="base-publisher">
<h2>Base Publisher<a class="headerlink" href="#base-publisher" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="BasePublisher">
<em class="property">class </em><tt class="descname">BasePublisher</tt><big>(</big><em>request [,*args] [,**kwargs]</em><big>)</big><a class="headerlink" href="#BasePublisher" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt>
<tt class="descname">CSRF = True</tt></dt>
<dd><p>Determines if CSRF protection is applied to the view function used in <tt class="docutils literal"><span class="pre">patterns</span></tt></p>
</dd></dl>

<dl class="attribute">
<dt id="BasePublisher.ACTION_PATTERN">
<tt class="descname">ACTION_PATTERN</tt><a class="headerlink" href="#BasePublisher.ACTION_PATTERN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="BasePublisher.OBJECT_PATTERN">
<tt class="descname">OBJECT_PATTERN</tt><a class="headerlink" href="#BasePublisher.OBJECT_PATTERN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="BasePublisher.ARGUMENT_PATTERN">
<tt class="descname">ARGUMENT_PATTERN</tt><a class="headerlink" href="#BasePublisher.ARGUMENT_PATTERN" title="Permalink to this definition">¶</a></dt>
<dd><p>Used by the <tt class="docutils literal"><span class="pre">patterns</span></tt> method to control the URL patterns generated.</p>
</dd></dl>

<dl class="classmethod">
<dt id="BasePublisher.patterns">
<em class="property">classmethod </em><tt class="descname">patterns</tt><big>(</big><em>api_name=None</em><big>)</big><a class="headerlink" href="#BasePublisher.patterns" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a list of URL patterns for this Publisher.</p>
<p>The <tt class="docutils literal"><span class="pre">api_name</span></tt> argument will be used for naming the url patterns.</p>
</dd></dl>

<dl class="classmethod">
<dt id="BasePublisher.index">
<em class="property">classmethod </em><tt class="descname">index</tt><big>(</big><big>)</big><a class="headerlink" href="#BasePublisher.index" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns details about handlers available on this publisher.</p>
<p>The result will be a dict with two keys: list, and detail.</p>
<p>Each item will contain a list of handlers and the HTTP verbs they accept.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">dispatch(request, action='default', object_id=None, **kwargs):</tt></dt>
<dd><p>Entry point used by the view function.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">execute(handler):</tt></dt>
<dd><p>Call hook for intercepting handlers.  <tt class="docutils literal"><span class="pre">dispatch</span></tt> passes the handler
method here to invoke.  It will call the handler, and catch any <tt class="docutils literal"><span class="pre">BaseHttpResponse</span></tt>
exceptions, returning them.</p>
<p>This was originally added to make New Relic support simpler.</p>
</dd></dl>

</dd></dl>

<div class="section" id="custom-patterns">
<h3>Custom Patterns<a class="headerlink" href="#custom-patterns" title="Permalink to this headline">¶</a></h3>
<p>By overridding the patterns method, you can provide your own url patterns.</p>
<p>One sample is included: nap.publisher.SimplePatternsMixin</p>
<p>It omits the object/ portion of the object urls above, but limits object_ids to
just digits.</p>
<p>Alternatively, if you just want to change the regex used for each part of the
URL, you can overrid them using OBJECT_PATTERN, ACTION_PATTERN, and
ARGUMENT_PATTERN, which default to &#8216;[-w]+&#8217;, &#8216;w+&#8217; and &#8216;.*?&#8217; respectively.</p>
</div>
</div>
<div class="section" id="publisher">
<h2>Publisher<a class="headerlink" href="#publisher" title="Permalink to this headline">¶</a></h2>
<p>The Publisher extends the BasePublisher class with some useful methods for
typical REST-ful uses.</p>
<dl class="class">
<dt id="Publisher">
<em class="property">class </em><tt class="descname">Publisher</tt><a class="headerlink" href="#Publisher" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="Publisher.page_size">
<tt class="descname">page_size</tt><a class="headerlink" href="#Publisher.page_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable pagination and specify the default page size.
Default: unset</p>
</dd></dl>

<dl class="attribute">
<dt id="Publisher.max_page_size">
<tt class="descname">max_page_size</tt><a class="headerlink" href="#Publisher.max_page_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Limit the maximum page size.
Default: page_size</p>
<p>If a request passes an override LIMIT value, it can not exceed this.</p>
</dd></dl>

<dl class="attribute">
<dt id="Publisher.LIMIT_PARAM">
<tt class="descname">LIMIT_PARAM</tt><a class="headerlink" href="#Publisher.LIMIT_PARAM" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the query parameter name used to specify the pagination size limit.
Default: &#8216;limit&#8217;</p>
</dd></dl>

<dl class="attribute">
<dt id="Publisher.OFFSET_PARAM">
<tt class="descname">OFFSET_PARAM</tt><a class="headerlink" href="#Publisher.OFFSET_PARAM" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the query parameter name used to specify the pagination offset.
Default: &#8216;offset&#8217;</p>
</dd></dl>

<dl class="attribute">
<dt id="Publisher.PAGE_PARAM">
<tt class="descname">PAGE_PARAM</tt><a class="headerlink" href="#Publisher.PAGE_PARAM" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies the query parameter name used to specify the pagination page.
Default: &#8216;page&#8217;</p>
</dd></dl>

<dl class="attribute">
<dt id="Publisher.response_class">
<tt class="descname">response_class</tt><a class="headerlink" href="#Publisher.response_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Default class to use in <tt class="docutils literal"><span class="pre">create_response</span></tt></p>
</dd></dl>

<dl class="attribute">
<dt id="Publisher.CONTENT_TYPES">
<tt class="descname">CONTENT_TYPES</tt><a class="headerlink" href="#Publisher.CONTENT_TYPES" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of content types supported by the de/serialiser.
Default: [&#8216;application/json&#8217;, &#8216;text/json&#8217;]</p>
<p>The first value in the list will be used as the content type of responses.</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.dumps">
<tt class="descname">dumps</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#Publisher.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to serialise data.  By default calls json.dumps.</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.loads">
<tt class="descname">loads</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#Publisher.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>Deserialise data.  By default calls json.loads.</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.get_serialiser">
<tt class="descname">get_serialiser</tt><big>(</big><big>)</big><a class="headerlink" href="#Publisher.get_serialiser" title="Permalink to this definition">¶</a></dt>
<dd><p>Called to get the <tt class="docutils literal"><span class="pre">Serialiser</span></tt> instance to use for this request.
Default: returns self.serialiser</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.get_serialiser_kwargs">
<tt class="descname">get_serialiser_kwargs</tt><big>(</big><big>)</big><a class="headerlink" href="#Publisher.get_serialiser_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to generate extra kwargs to pass to serialiser calls (i.e.
object_deflate, list_deflate, etc)</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.get_object_list">
<tt class="descname">get_object_list</tt><big>(</big><big>)</big><a class="headerlink" href="#Publisher.get_object_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the raw object list for this request.
This is Not Implemented.  You must provide this method in your Serialiser
class.</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.get_object">
<tt class="descname">get_object</tt><big>(</big><em>object_id</em><big>)</big><a class="headerlink" href="#Publisher.get_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the object for the given ID.
You must provide this method in your Serialiser class.</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.filter_object_list">
<tt class="descname">filter_object_list</tt><big>(</big><em>object_list</em><big>)</big><a class="headerlink" href="#Publisher.filter_object_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply filtering to an object list, returning the filtered list.
Default: Returns the passed object_list.</p>
</dd></dl>

<dl class="method">
<dt id="Publisher.sort_object_list">
<tt class="descname">sort_object_list</tt><big>(</big><em>object_list</em><big>)</big><a class="headerlink" href="#Publisher.sort_object_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply sorting to an object list, returning the sorted list.
Default: Returns the passed object_list.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">get_page(object_list):</tt></dt>
<dd><p>Paginate the object_list.</p>
<p>If the page_size is not defined on the Serialiser, no pagination is
performed, and the following dict is returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;meta&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s">&#39;objects&#39;</span><span class="p">:</span> <span class="n">object_list</span> <span class="p">}</span>
</pre></div>
</div>
<p>Otherwise, the object_list is paginated.  If self.PAGE_PARAM was passed,
it will be used for the page number.  It not, and self.OFFSET_PARAM is
supplied, the page will be determined by dividing the offset by page_size.</p>
<p>The <tt class="docutils literal"><span class="pre">meta</span></tt> dict will contain:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;offset&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">start_index</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<span class="s">&#39;page&#39;</span><span class="p">:</span> <span class="n">page_num</span><span class="p">,</span>
<span class="s">&#39;total_pages&#39;</span><span class="p">:</span> <span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">,</span>
<span class="s">&#39;limit&#39;</span><span class="p">:</span> <span class="n">page_size</span><span class="p">,</span>
<span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="n">paginator</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
<span class="s">&#39;has_next&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">(),</span>
<span class="s">&#39;has_prev&#39;</span><span class="p">:</span> <span class="n">page</span><span class="o">.</span><span class="n">has_previous</span><span class="p">(),</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Publisher.get_request_data">
<tt class="descname">get_request_data</tt><big>(</big><big>)</big><a class="headerlink" href="#Publisher.get_request_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the data sent in this request.
If the request type is specified in <tt class="docutils literal"><span class="pre">CONTENT_TYPES</span></tt> it will be used to
de-serialise the data.  Otherwise, request.GET or request.POST will be
returned as apporpriate for the HTTP method used.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">render_single_object(obj, serialiser=None, **kwargs):</tt></dt>
<dd><p>A helper function to serialise the object and create a response, using
self.response_class.  If <tt class="docutils literal"><span class="pre">serialiser</span></tt> is None, it will call
<tt class="docutils literal"><span class="pre">get_serialiser</span></tt>.  The kwargs will be passed on to <tt class="docutils literal"><span class="pre">create_response</span></tt></p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">create_response(content, **kwargs):</tt></dt>
<dd><p>A helper function for building <tt class="docutils literal"><span class="pre">self.response_class</span></tt>.
Passing response_class as an argument overrides the class used.</p>
<p>It sets &#8216;content_type&#8217; in kwargs to self.CONTENT_TYPES[0] if it&#8217;s not set.
Then, it passes <tt class="docutils literal"><span class="pre">content</span></tt> to <tt class="docutils literal"><span class="pre">self.dumps</span></tt>, and passes that, along with
kwargs, to build a new response_class instance, returning it.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">list_get_default(request, **kwargs):</tt></dt>
<dd><p>Default list handler.</p>
<p>Calls <cite>get_object_list</cite>, <cite>filter_object_list</cite> and <cite>sort_object_list</cite>,
then passes the list to <cite>get_page</cite>.  It then uses the object from
<cite>get_serialiser</cite> to deflate the object list.</p>
<p>Returns the resulting data using <tt class="docutils literal"><span class="pre">create_response</span></tt>.</p>
</dd></dl>

</dd></dl>

<div class="section" id="filtering-and-sorting">
<h3>Filtering and Sorting<a class="headerlink" href="#filtering-and-sorting" title="Permalink to this headline">¶</a></h3>
<p>The Publisher class has two methods for sorting and filtering:</p>
<dl class="method">
<dt id="filter_object_list">
<tt class="descname">filter_object_list</tt><big>(</big><em>object_list</em><big>)</big><a class="headerlink" href="#filter_object_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="sort_object_list">
<tt class="descname">sort_object_list</tt><big>(</big><em>object_list</em><big>)</big><a class="headerlink" href="#sort_object_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>By default, these simply return the list they are passed.</p>
<p>Filtering and sorting are not applied by get_object_list.  This lets you apply
required filtering [site, security, user, etc] in get_object_list, and optional
filtering [query, etc] where it&#8217;s wanted.  Also, ordering can be an unwanted
expense when it&#8217;s not important to the use.</p>
<p>The default Publisher.list_get_default will pass the result of get_object_list
to filter_object_list and sort_object_list in turn before serialising.</p>
</div>
</div>
<div class="section" id="modelpublisher">
<h2>ModelPublisher<a class="headerlink" href="#modelpublisher" title="Permalink to this headline">¶</a></h2>
<p>The ModelPublisher implements some default handlers that are more sensible for a
Model.</p>
<p>It includes a default <tt class="docutils literal"><span class="pre">model</span></tt> property that will return the model from the
meta class of self.serialiser.  This way, by default, it will publish the model
of its default Serialiser.</p>
</div>
<div class="section" id="modelformmixin">
<h2>ModelFormMixin<a class="headerlink" href="#modelformmixin" title="Permalink to this headline">¶</a></h2>
<p>This class provides <tt class="docutils literal"><span class="pre">list_post_default</span></tt> and <tt class="docutils literal"><span class="pre">object_put_default</span></tt> that will
use a ModelForm to validate and creat/update objects.  It uses the same methods
as a standard Django FormMixin class-based view.</p>
<p>It also includes an <tt class="docutils literal"><span class="pre">object_delete_default</span></tt> method.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Publishers</a><ul>
<li><a class="reference internal" href="#publishing">Publishing</a></li>
<li><a class="reference internal" href="#base-publisher">Base Publisher</a><ul>
<li><a class="reference internal" href="#custom-patterns">Custom Patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publisher">Publisher</a><ul>
<li><a class="reference internal" href="#filtering-and-sorting">Filtering and Sorting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modelpublisher">ModelPublisher</a></li>
<li><a class="reference internal" href="#modelformmixin">ModelFormMixin</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="fields.html"
                        title="previous chapter">Fields</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="auth.html"
                        title="next chapter">Authorisation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/publisher.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="auth.html" title="Authorisation"
             >next</a> |</li>
        <li class="right" >
          <a href="fields.html" title="Fields"
             >previous</a> |</li>
        <li><a href="index.html">django-nap 0.13.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Curtis Maloney.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>